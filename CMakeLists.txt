# ProjectRoot/CMakeLists.txt

# 1. ğŸŒŸ å¿…é¡»æ˜¯ç¬¬ä¸€è¡Œï¼šå®šä¹‰æ‰€éœ€çš„æœ€å° CMake ç‰ˆæœ¬
cmake_minimum_required(VERSION 3.10)

# 2. ğŸŒŸ å¿…é¡»æ˜¯ç¬¬äºŒè¡Œï¼šå®šä¹‰é¡¹ç›®åç§°
project(mygameserver CXX)

# è®¾ç½® C++ æ ‡å‡†
set(CMAKE_CXX_STANDARD 20)
set(CMAKE_CXX_STANDARD_REQUIRED True)

# ============== å¤–éƒ¨ä¾èµ–æŸ¥æ‰¾ (Boost å’Œ Protobuf) ==============
#find_package(Boost 1.70 REQUIRED COMPONENTS system thread)
# 3. ğŸŒŸ å¿…é¡»åœ¨è°ƒç”¨ protobuf_generate_cpp() ä¹‹å‰æ‰§è¡Œï¼
find_package(Protobuf REQUIRED)
# 3. ğŸŒŸ å¿…é¡»åœ¨è°ƒç”¨ protobuf_generate_cpp() ä¹‹å‰æ‰§è¡Œï¼
find_package(Protobuf REQUIRED) 

# ==================== Protobuf ç¼–è¯‘è‡ªåŠ¨åŒ–ä¸åº“å®šä¹‰ ====================

set(PROTO_SRC_DIR "${CMAKE_CURRENT_SOURCE_DIR}/proto")
file(GLOB PROTO_FILES "${PROTO_SRC_DIR}/*.proto")

# ç°åœ¨å‡½æ•°å·²è¢«åŠ è½½ï¼Œå¯ä»¥å®‰å…¨è°ƒç”¨
protobuf_generate_cpp(PROTO_SRCS PROTO_HDRS ${PROTO_FILES})

# åˆ›å»ºä¸€ä¸ªé™æ€åº“æ¥ç¼–è¯‘æ‰€æœ‰ç”Ÿæˆçš„ Protobuf æºæ–‡ä»¶
add_library(ProtoMessages STATIC ${PROTO_SRCS})
target_link_libraries(ProtoMessages PUBLIC ${Protobuf_LIBRARIES})

# ==================== å…¬å…±å¤´æ–‡ä»¶æ¥å£å®šä¹‰ ====================

# å®šä¹‰ CommonHeaders æ¥å£åº“
add_library(CommonHeaders INTERFACE)

target_include_directories(CommonHeaders INTERFACE 
    # å…¬å…±å¤´æ–‡ä»¶è·¯å¾„ï¼š/include ç›®å½•ä¸‹çš„æ–‡ä»¶
    $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include/server>
    $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include>
    $<BUILD_INTERFACE:${CMAKE_CURRENT_SOURCE_DIR}/include/client>
    # Protobuf ç”Ÿæˆå¤´æ–‡ä»¶ï¼ˆ.pb.hï¼‰çš„è·¯å¾„
    $<BUILD_INTERFACE:${CMAKE_CURRENT_BINARY_DIR}>
)
set(CMAKE_PREFIX_PATH 
    "/usr/local" 
    "/usr" 
    "/usr/local/lib" 
    "/usr/lib" # ç¡®ä¿ /usr/lib ä¹Ÿè¢«åŒ…å«
    "/usr/lib/x86_64-linux-gnu" 
    ${CMAKE_PREFIX_PATH}
)

set(MYSQL_LIBRARY "/usr/lib/x86_64-linux-gnu/libmysqlclient.so")


# ============== æ·»åŠ å­ç›®å½• ==============
add_subdirectory(src/client)
add_subdirectory(src/server)