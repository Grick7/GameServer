# src/server/CMakeLists.txt

# æ˜ç¡®åˆ—å‡ºæœåŠ¡å™¨æºæ–‡ä»¶
set(SERVER_SOURCES
    main.cc
    Session.cc
    DB.cc
    GameServer.cc
    SessionManager.cc
    MessageDispatcher.cc
    Usermodel.cc
    PlayerDataManager.cc
    Room.cc
    BattleRoom.cc
    RoomManager.cc
    UserDatamodel.cc
    ThreadPool.cc

)

# 1. åˆ›å»ºå¯æ‰§è¡Œç›®æ ‡ï¼ŒåªåŒ…å«æ‰‹åŠ¨ç¼–å†™çš„æºæ–‡ä»¶
add_executable(MyServerExec ${SERVER_SOURCES})
# è®¾ç½® pkgconfig è·¯å¾„
#set(CMAKE_PREFIX_PATH "/usr/local/lib/pkgconfig" ${CMAKE_PREFIX_PATH})
#set(CMAKE_PREFIX_PATH "/usr/lib/x86_64-linux-gnu/pkgconfig" ${CMAKE_PREFIX_PATH})
# 2. ğŸŒŸ å…³é”®ï¼šé“¾æ¥ Protobuf æ¶ˆæ¯åº“ (æ›¿ä»£äº† target_sources)
# ç§»é™¤ target_sources(<TargetName> PRIVATE ${PROTO_SRCS})
# 1. æŸ¥æ‰¾ PKG-CONFIG ç¨‹åºæœ¬èº«
find_package(PkgConfig REQUIRED)
# 2. ä½¿ç”¨ pkg-config æŸ¥æ‰¾ hiredis åº“
#    è¿™ä¼šè®¾ç½® ${HIREDIS_LIBRARIES} å’Œ ${HIREDIS_INCLUDE_DIRS}
pkg_check_modules(HIREDIS REQUIRED hiredis)
# æ·»åŠ  pkg-config æŸ¥æ‰¾é€»è¾‘:
# 3. ğŸŒŸ å…³é”®ä¿®æ­£ 2: ç¡®ä¿å¤´æ–‡ä»¶è·¯å¾„è¢«åŒ…å« (hiredis éœ€è¦)
target_include_directories(MyServerExec
    PRIVATE
        ${HIREDIS_INCLUDE_DIRS}
        # ... å…¶ä»–å¤´æ–‡ä»¶è·¯å¾„
)
# ğŸŒŸ å…³é”®æ·»åŠ ï¼šæ‰‹åŠ¨å°† vcpkg çš„å®‰è£…ç›®å½•æ·»åŠ åˆ° CMAKE_PREFIX_PATH
list(APPEND CMAKE_PREFIX_PATH 
    "/home/grick/package/vcpkg/vcpkg/installed/x64-linux"
)
# 1. æŸ¥æ‰¾ cppkafka åŒ…
# è¿™ä¸€è¡Œå‘Šè¯‰ CMake å¯»æ‰¾ vcpkg å®‰è£…çš„ cppkafka åº“
find_package(CppKafka REQUIRED)

# 2. è®¾ç½® CMake æŸ¥æ‰¾åº“çš„è·¯å¾„

# ... (target_include_directories ä¿æŒä¸å˜) ...
# æ›¿æ¢ä¸ºå®é™…æ‰¾åˆ°çš„å®Œæ•´è·¯å¾„
#set(NEW_HIREDIS_PATH "/usr/local/lib/libhiredis.so.1.3.0")

# ============== é“¾æ¥ä¾èµ– ==============
target_link_libraries(MyServerExec 
    PUBLIC 
        CommonHeaders
    PRIVATE 
    # å¼ºåˆ¶é“¾æ¥æ–°ç‰ˆæœ¬ï¼Œå¹¶æ”¾åœ¨æœ€å‰é¢
        #${NEW_HIREDIS_PATH}
        #Boost::system        
        #Boost::thread 
        ProtoMessages        
        ${MYSQL_LIBRARY}
        
        # Redis++ (å·²ä¿®æ­£ä¸ºæ­£ç¡®çš„åº“å)
        redis++
        
        # é“¾æ¥ hiredis åº“ (ä½¿ç”¨ pkg-config æ‰¾åˆ°çš„å˜é‡)
        ${HIREDIS_LIBRARIES} 
        # é“¾æ¥ CppKafka ç›®æ ‡ï¼ˆä½¿ç”¨å¯¼å‡ºçš„ç›®æ ‡åï¼‰
        CppKafka::cppkafka
)